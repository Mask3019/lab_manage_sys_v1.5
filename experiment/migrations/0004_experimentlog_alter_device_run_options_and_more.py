# Generated by Django 5.0.6 on 2025-04-25 07:26

from django.db import migrations, models
from django.db.migrations.operations.special import RunSQL


class Migration(migrations.Migration):

    dependencies = [
        ("experiment", "0003_taskapplication_test_contentextra"),
    ]

    operations = [
        # 首先尝试删除已存在的视图或表
        RunSQL(
            "DROP VIEW IF EXISTS experiment_log;",
            "DROP TABLE IF EXISTS experiment_log;"
        ),
        migrations.CreateModel(
            name="ExperimentLog",
            fields=[
                (
                    "log_id",
                    models.CharField(
                        max_length=20,
                        primary_key=True,
                        serialize=False,
                        verbose_name="记录ID",
                    ),
                ),
                (
                    "task_number",
                    models.CharField(
                        db_index=True, max_length=100, verbose_name="任务单编号"
                    ),
                ),
                (
                    "project_code",
                    models.CharField(
                        db_index=True, max_length=100, verbose_name="项目代号"
                    ),
                ),
                (
                    "sample_number",
                    models.CharField(max_length=100, verbose_name="样件编号"),
                ),
                (
                    "test_content",
                    models.CharField(max_length=150, verbose_name="试验内容"),
                ),
                (
                    "equipment_id",
                    models.CharField(
                        db_index=True, max_length=30, verbose_name="设备编号"
                    ),
                ),
                (
                    "stop_duration",
                    models.DecimalField(
                        decimal_places=2,
                        default=0,
                        max_digits=5,
                        verbose_name="停止时长",
                    ),
                ),
                (
                    "log_date",
                    models.DateTimeField(db_index=True, verbose_name="登记日期"),
                ),
                (
                    "alarm_phenomenon",
                    models.TextField(blank=True, verbose_name="报警现象"),
                ),
                ("alarm_reason", models.TextField(blank=True, verbose_name="报警原因")),
                ("solution", models.TextField(blank=True, verbose_name="解决办法")),
                ("solver", models.CharField(max_length=50, verbose_name="解决人")),
                (
                    "data_path",
                    models.CharField(
                        blank=True, max_length=255, verbose_name="数据记录路径"
                    ),
                ),
                (
                    "analysis_report",
                    models.CharField(
                        blank=True, max_length=255, verbose_name="分析报告"
                    ),
                ),
                ("remarks", models.TextField(blank=True, verbose_name="备注")),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "试验履历表",
                "verbose_name_plural": "试验履历表",
                "db_table": "experiment_log",
                "ordering": ["-log_date", "-log_id"],
            },
        ),
        migrations.AlterModelOptions(
            name="device_run",
            options={
                "ordering": ["-date", "-id"],
                "verbose_name": "设备运行",
                "verbose_name_plural": "设备运行",
            },
        ),
        migrations.AlterModelOptions(
            name="ganttproject",
            options={"ordering": ["project_id"]},
        ),
        migrations.AlterModelOptions(
            name="taskapplication",
            options={"ordering": ["-created_at"]},
        ),
        migrations.RemoveField(
            model_name="ganttproject",
            name="id",
        ),
        migrations.AlterField(
            model_name="device_run",
            name="bench_fault",
            field=models.DecimalField(
                decimal_places=2, default=0, max_digits=5, verbose_name="台架故障"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="bench_status",
            field=models.CharField(max_length=20, verbose_name="台架状态"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="date",
            field=models.DateTimeField(db_index=True),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="debugging",
            field=models.DecimalField(
                decimal_places=2, default=0, max_digits=5, verbose_name="调试"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="device_number",
            field=models.CharField(
                db_index=True, max_length=50, verbose_name="设备编号"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="dvp_plan",
            field=models.CharField(max_length=5, verbose_name="DVP计划内"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="id",
            field=models.CharField(
                max_length=20, primary_key=True, serialize=False, verbose_name="序号"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="idle",
            field=models.DecimalField(
                decimal_places=2, default=0, max_digits=5, verbose_name="闲置"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="progress",
            field=models.CharField(max_length=10, verbose_name="试验进度"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="remarks",
            field=models.TextField(blank=True, verbose_name="备注"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="responsible_person",
            field=models.CharField(max_length=50, verbose_name="责任人"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="running",
            field=models.DecimalField(
                decimal_places=2, default=0, max_digits=5, verbose_name="运行"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="sample_fault",
            field=models.DecimalField(
                decimal_places=2, default=0, max_digits=5, verbose_name="样件故障"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="sample_number",
            field=models.CharField(max_length=100, verbose_name="样品编号"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="task_number",
            field=models.CharField(
                db_index=True, max_length=100, verbose_name="任务单号"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="task_status",
            field=models.CharField(
                db_index=True, max_length=20, verbose_name="任务状态"
            ),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="test_content",
            field=models.CharField(max_length=150, verbose_name="试验内容"),
        ),
        migrations.AlterField(
            model_name="device_run",
            name="transmission_model",
            field=models.CharField(max_length=100, verbose_name="变速器型号"),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="code",
            field=models.CharField(blank=True, max_length=100),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="depends",
            field=models.CharField(blank=True, max_length=100),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="end",
            field=models.DateTimeField(db_index=True),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="project_id",
            field=models.IntegerField(primary_key=True, serialize=False),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="start",
            field=models.DateTimeField(db_index=True),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="type",
            field=models.CharField(blank=True, max_length=100),
        ),
        migrations.AlterField(
            model_name="ganttproject",
            name="type_id",
            field=models.CharField(blank=True, max_length=50),
        ),
        migrations.AlterField(
            model_name="taskapplication",
            name="created_at",
            field=models.DateTimeField(auto_now_add=True, db_index=True),
        ),
        migrations.AlterField(
            model_name="taskapplication",
            name="project_code",
            field=models.CharField(db_index=True, max_length=100),
        ),
        migrations.AlterField(
            model_name="taskapplication",
            name="task_number",
            field=models.CharField(db_index=True, max_length=100, unique=True),
        ),
        migrations.AlterField(
            model_name="tasks",
            name="project",
            field=models.CharField(db_index=True, max_length=30),
        ),
        migrations.AlterField(
            model_name="tasks",
            name="task_date",
            field=models.DateField(db_index=True),
        ),
        migrations.AlterField(
            model_name="tasks",
            name="task_id",
            field=models.CharField(db_index=True, max_length=10),
        ),
        migrations.AlterField(
            model_name="tasks",
            name="task_status",
            field=models.CharField(db_index=True, max_length=10),
        ),
        migrations.AddIndex(
            model_name="device_run",
            index=models.Index(
                fields=["task_status", "date"], name="device_run_task_st_ec1cb6_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="device_run",
            index=models.Index(
                fields=["device_number", "date"], name="device_run_device__6b48b1_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="taskapplication",
            index=models.Index(
                fields=["task_source", "business_type"],
                name="experiment__task_so_56bbd1_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="tasks",
            index=models.Index(
                fields=["task_status", "task_date"],
                name="experiment__task_st_589cad_idx",
            ),
        ),
    ]
